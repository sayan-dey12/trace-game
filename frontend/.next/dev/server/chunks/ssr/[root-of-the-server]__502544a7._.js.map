{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///E:/personal/fun/consent-trace-app/frontend/pages/admin.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\n\r\nconst BACKEND = process.env.NEXT_PUBLIC_BACKEND || \"http://localhost:4000\";\r\n\r\nexport default function AdminPage() {\r\n  const [logged, setLogged] = useState(false);\r\n  const [u, setU] = useState(\"\");\r\n  const [p, setP] = useState(\"\");\r\n\r\n  const [events, setEvents] = useState<any[]>([]);\r\n  const [uploads, setUploads] = useState<any[]>([]);\r\n\r\n  // -----------------------------\r\n  // AUTO LOGIN IF TOKEN EXISTS\r\n  // -----------------------------\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"admin_token\");\r\n    if (token) {\r\n      setLogged(true);\r\n      loadData();\r\n    }\r\n  }, []);\r\n\r\n  // -----------------------------\r\n  // LOGIN FUNCTION\r\n  // -----------------------------\r\n  async function login() {\r\n    const res = await fetch(`${BACKEND}/admin/login`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ user: u, pass: p }),\r\n    });\r\n\r\n    const json = await res.json();\r\n\r\n    if (json.ok) {\r\n      localStorage.setItem(\"admin_token\", json.token);\r\n      setLogged(true);\r\n      loadData();\r\n    } else {\r\n      alert(\"Wrong admin login\");\r\n    }\r\n  }\r\n\r\n  // -----------------------------\r\n  // FETCH DATA (requires token)\r\n  // -----------------------------\r\n  async function loadData() {\r\n    const token = localStorage.getItem(\"admin_token\");\r\n\r\n    const ev = await fetch(`${BACKEND}/admin/events`, {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    }).then((r) => r.json());\r\n\r\n    const up = await fetch(`${BACKEND}/admin/uploads`, {\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    }).then((r) => r.json());\r\n\r\n    setEvents(ev);\r\n    setUploads(up);\r\n  }\r\n\r\n  // -----------------------------\r\n  // DELETE UPLOAD\r\n  // -----------------------------\r\n  async function deleteUpload(id: number, publicId: string) {\r\n    const ok = confirm(\"Delete this upload permanently?\");\r\n    if (!ok) return;\r\n\r\n    const token = localStorage.getItem(\"admin_token\");\r\n\r\n    const res = await fetch(`${BACKEND}/admin/delete-upload/${id}`, {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n      body: JSON.stringify({ public_id: publicId }),\r\n    });\r\n\r\n    const json = await res.json();\r\n    if (json.ok) {\r\n      alert(\"Deleted successfully\");\r\n      loadData();\r\n    } else {\r\n      alert(\"Delete failed\");\r\n    }\r\n  }\r\n\r\n  // -----------------------------\r\n  // DOWNLOAD IMAGE\r\n  // -----------------------------\r\n  function downloadImage(url: string) {\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"photo.jpg\";\r\n    a.click();\r\n  }\r\n\r\n  // -----------------------------\r\n  // LOGIN SCREEN\r\n  // -----------------------------\r\n  if (!logged) {\r\n    return (\r\n      <main style={{ padding: 20 }}>\r\n        <h1>Admin Login</h1>\r\n        <input\r\n          placeholder=\"username\"\r\n          value={u}\r\n          onChange={(e) => setU(e.target.value)}\r\n        />\r\n        <br />\r\n        <input\r\n          type=\"password\"\r\n          placeholder=\"password\"\r\n          value={p}\r\n          onChange={(e) => setP(e.target.value)}\r\n        />\r\n        <br />\r\n        <button onClick={login}>Login</button>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  // -----------------------------\r\n  // ADMIN PANEL\r\n  // -----------------------------\r\n  return (\r\n    <main style={{ padding: 20 }}>\r\n      <h1>Admin Panel</h1>\r\n\r\n      <button\r\n        onClick={() => {\r\n          localStorage.removeItem(\"admin_token\");\r\n          setLogged(false);\r\n        }}\r\n        style={{ marginBottom: 20 }}\r\n      >\r\n        Logout\r\n      </button>\r\n\r\n      <h2>Events</h2>\r\n      <table border={1} cellPadding={6}>\r\n        <thead>\r\n          <tr>\r\n            <th>ID</th>\r\n            <th>IP</th>\r\n            <th>User Agent</th>\r\n            <th>City</th>\r\n            <th>Region</th>\r\n            <th>Country</th>\r\n            <th>Created</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {events.map((e) => (\r\n            <tr key={e.id}>\r\n              <td>{e.id}</td>\r\n              <td>{e.ip}</td>\r\n              <td>{e.user_agent}</td>\r\n              <td>{e.city}</td>\r\n              <td>{e.region}</td>\r\n              <td>{e.country}</td>\r\n              <td>{e.created_at}</td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      <h2>Uploads</h2>\r\n      <table border={1} cellPadding={6}>\r\n        <thead>\r\n          <tr>\r\n            <th>ID</th>\r\n            <th>Image</th>\r\n            <th>IP</th>\r\n            <th>Latitude</th>\r\n            <th>Longitude</th>\r\n            <th>Created</th>\r\n            <th>Actions</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {uploads.map((u) => (\r\n            <tr key={u.id}>\r\n              <td>{u.id}</td>\r\n              <td>\r\n                <img src={u.cloudinary_url} width=\"140\" />\r\n              </td>\r\n              <td>{u.ip}</td>\r\n              <td>{u.latitude}</td>\r\n              <td>{u.longitude}</td>\r\n              <td>{u.created_at}</td>\r\n              <td>\r\n                <button onClick={() => downloadImage(u.cloudinary_url)}>\r\n                  Download\r\n                </button>\r\n                <button\r\n                  onClick={() => deleteUpload(u.id, u.cloudinary_public_id)}\r\n                  style={{ background: \"red\", color: \"white\", marginLeft: 10 }}\r\n                >\r\n                  Delete\r\n                </button>\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}