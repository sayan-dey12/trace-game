{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///E:/personal/fun/consent-trace-app/frontend/pages/admin.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\n\r\nconst BACKEND = process.env.NEXT_PUBLIC_BACKEND || \"http://localhost:4000\";\r\n\r\nexport default function AdminPage() {\r\n  const [logged, setLogged] = useState(false);\r\n  const [u, setU] = useState(\"\");\r\n  const [p, setP] = useState(\"\");\r\n\r\n  const [events, setEvents] = useState<any[]>([]);\r\n  const [uploads, setUploads] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"admin_token\");\r\n    if (token) {\r\n      setLogged(true);\r\n      loadData();\r\n    }\r\n  }, []);\r\n\r\n  async function login() {\r\n    const res = await fetch(`${BACKEND}/admin/login`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ user: u, pass: p }),\r\n    });\r\n\r\n    const json = await res.json();\r\n\r\n    if (json.ok) {\r\n      localStorage.setItem(\"admin_token\", json.token);\r\n      setLogged(true);\r\n      loadData();\r\n    } else {\r\n      alert(\"Wrong admin login\");\r\n    }\r\n  }\r\n\r\n  async function loadData() {\r\n  const token = localStorage.getItem(\"admin_token\");\r\n\r\n  const evRes = await fetch(`${BACKEND}/admin/events`, {\r\n    headers: { Authorization: `Bearer ${token}` },\r\n  });\r\n\r\n  const upRes = await fetch(`${BACKEND}/admin/uploads`, {\r\n    headers: { Authorization: `Bearer ${token}` },\r\n  });\r\n\r\n  const evJson = await evRes.json();\r\n  const upJson = await upRes.json();\r\n\r\n  // ðŸŸ¢ FIX: Always convert to array\r\n  setEvents(Array.isArray(evJson) ? evJson : []);\r\n  setUploads(Array.isArray(upJson) ? upJson : []);\r\n}\r\n\r\n\r\n  async function deleteUpload(id: number, publicId: string) {\r\n    if (!confirm(\"Delete this upload?\")) return;\r\n\r\n    const token = localStorage.getItem(\"admin_token\");\r\n\r\n    const res = await fetch(`${BACKEND}/admin/delete-upload/${id}`, {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n      body: JSON.stringify({ public_id: publicId }),\r\n    });\r\n\r\n    const json = await res.json();\r\n    if (json.ok) loadData();\r\n  }\r\n\r\n  function formatIST(dateStr: string) {\r\n  if (!dateStr) return \"\";\r\n  return new Date(dateStr).toLocaleString(\"en-IN\", {\r\n    timeZone: \"Asia/Kolkata\",\r\n    hour12: true\r\n  });\r\n}\r\n  async function deleteAllUploads() {\r\n    if (!confirm(\"Delete ALL uploads permanently?\")) return;\r\n\r\n    const token = localStorage.getItem(\"admin_token\");\r\n\r\n    const res = await fetch(`${BACKEND}/admin/delete-all`, {\r\n      method: \"DELETE\",\r\n      headers: { Authorization: `Bearer ${token}` },\r\n    });\r\n\r\n    const json = await res.json();\r\n    if (json.ok) {\r\n      alert(\"All uploads deleted\");\r\n      loadData();\r\n    }\r\n  }\r\n\r\n  function downloadImage(url: string) {\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"photo.jpg\";\r\n    a.click();\r\n  }\r\n\r\n  if (!logged) {\r\n    return (\r\n      <main style={styles.container}>\r\n        <h1>Admin Login</h1>\r\n        <input style={styles.input} placeholder=\"Username\" onChange={(e) => setU(e.target.value)} />\r\n        <input style={styles.input} placeholder=\"Password\" type=\"password\" onChange={(e) => setP(e.target.value)} />\r\n        <button style={styles.button} onClick={login}>Login</button>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <main style={styles.container}>\r\n      <div style={styles.topBar}>\r\n        <h1>Admin Panel</h1>\r\n        <button\r\n          style={styles.logoutButton}\r\n          onClick={() => {\r\n            localStorage.removeItem(\"admin_token\");\r\n            setLogged(false);\r\n          }}\r\n        >\r\n          Logout\r\n        </button>\r\n      </div>\r\n\r\n      <h2>Uploads</h2>\r\n\r\n      <button onClick={deleteAllUploads} style={styles.deleteAllButton}>\r\n        Delete ALL Uploads\r\n      </button>\r\n\r\n      <table style={styles.table}>\r\n        <thead>\r\n          <tr>\r\n            <th>ID</th>\r\n            <th>Preview</th>\r\n            <th>IP</th>\r\n            <th>Lat</th>\r\n            <th>Lon</th>\r\n            <th>Created</th>\r\n            <th>Actions</th>\r\n          </tr>\r\n        </thead>\r\n\r\n        <tbody>\r\n          {uploads.map((u) => (\r\n            <tr key={u.id}>\r\n              <td>{u.id}</td>\r\n              <td><img src={u.cloudinary_url} style={styles.thumbnail} /></td>\r\n              <td>{u.ip}</td>\r\n              <td>{u.latitude}</td>\r\n              <td>{u.longitude}</td>\r\n              <td>{formatIST(u.created_at)}</td>\r\n              <td>\r\n                <button style={styles.smallButton} onClick={() => downloadImage(u.cloudinary_url)}>Download</button>\r\n                <button style={styles.deleteButton} onClick={() => deleteUpload(u.id, u.cloudinary_public_id)}>Delete</button>\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      <h2>Events</h2>\r\n\r\n      <table style={styles.table}>\r\n        <thead>\r\n          <tr>\r\n            <th>ID</th>\r\n            <th>IP</th>\r\n            <th>User Agent</th>\r\n            <th>City</th>\r\n            <th>Region</th>\r\n            <th>Country</th>\r\n            <th>Created</th>\r\n          </tr>\r\n        </thead>\r\n\r\n        <tbody>\r\n          {events.map((e) => (\r\n            <tr key={e.id}>\r\n              <td>{e.id}</td>\r\n              <td>{e.ip}</td>\r\n              <td>{e.user_agent}</td>\r\n              <td>{e.city}</td>\r\n              <td>{e.region}</td>\r\n              <td>{e.country}</td>\r\n              <td>{e.created_at}</td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </main>\r\n  );\r\n}\r\n\r\nconst styles = {\r\n  container: {\r\n    padding: 20,\r\n    fontFamily: \"Arial\",\r\n  },\r\n  input: {\r\n    padding: \"10px\",\r\n    margin: \"8px 0\",\r\n    width: \"240px\",\r\n    fontSize: \"16px\",\r\n  },\r\n  button: {\r\n    padding: \"12px 20px\",\r\n    background: \"green\",\r\n    color: \"white\",\r\n    border: \"none\",\r\n    cursor: \"pointer\",\r\n    marginTop: 10,\r\n  },\r\n  logoutButton: {\r\n    padding: \"10px 16px\",\r\n    background: \"red\",\r\n    color: \"white\",\r\n    border: \"none\",\r\n    cursor: \"pointer\",\r\n    height: 40,\r\n  },\r\n  topBar: {\r\n    display: \"flex\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n  },\r\n  table: {\r\n    width: \"100%\",\r\n    borderCollapse: \"collapse\" as const,\r\n    marginTop: 20,\r\n  },\r\n  thumbnail: {\r\n    width: 100,\r\n    borderRadius: 6,\r\n  },\r\n  smallButton: {\r\n    padding: \"6px 10px\",\r\n    background: \"#007bff\",\r\n    color: \"white\",\r\n    border: \"none\",\r\n    cursor: \"pointer\",\r\n    marginRight: 8,\r\n  },\r\n  deleteButton: {\r\n    padding: \"6px 10px\",\r\n    background: \"red\",\r\n    color: \"white\",\r\n    border: \"none\",\r\n    cursor: \"pointer\",\r\n  },\r\n  deleteAllButton: {\r\n    padding: \"10px 20px\",\r\n    background: \"darkred\",\r\n    color: \"white\",\r\n    border: \"none\",\r\n    cursor: \"pointer\",\r\n    marginBottom: 15,\r\n  },\r\n};\r\n"],"names":[],"mappings":"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"}}]
}