{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///E:/personal/fun/consent-trace-app/frontend/pages/index.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\r\nimport { QRCodeCanvas } from \"qrcode.react\";\r\n\r\nconst BACKEND = process.env.NEXT_PUBLIC_BACKEND || \"http://localhost:4000\";\r\n\r\nexport default function HomePage() {\r\n  const [trackRes, setTrackRes] = useState<any>(null);\r\n  const [gps, setGps] = useState<string | null>(null);\r\n  const [uploadInfo, setUploadInfo] = useState<any>(null);\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const [stream, setStream] = useState<MediaStream | null>(null);\r\n\r\n  async function handleTrack() {\r\n    const res = await fetch(`${BACKEND}/api/track`);\r\n    const json = await res.json();\r\n    setTrackRes(json);\r\n  }\r\n\r\n  function handleGPS() {\r\n    if (!navigator.geolocation) return setGps(\"Geolocation not supported\");\r\n\r\n    navigator.geolocation.getCurrentPosition(\r\n      (pos) => {\r\n        setGps(`Lat: ${pos.coords.latitude}, Lon: ${pos.coords.longitude}`);\r\n      },\r\n      (err) => setGps(`Denied: ${err.message}`)\r\n    );\r\n  }\r\n\r\n  async function openCamera() {\r\n    try {\r\n      const s = await navigator.mediaDevices.getUserMedia({ video: true });\r\n      setStream(s);\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = s;\r\n        videoRef.current.play();\r\n      }\r\n    } catch (err: any) {\r\n      alert(\"Camera denied: \" + err.message);\r\n    }\r\n  }\r\n\r\n  async function takePhoto() {\r\n    if (!videoRef.current) return;\r\n\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = videoRef.current.videoWidth;\r\n    canvas.height = videoRef.current.videoHeight;\r\n\r\n    const ctx = canvas.getContext(\"2d\");\r\n    ctx?.drawImage(videoRef.current, 0, 0);\r\n\r\n    const blob = await new Promise<Blob | null>((resolve) =>\r\n      canvas.toBlob(resolve, \"image/jpeg\", 0.9)\r\n    );\r\n\r\n    if (!blob) return alert(\"Could not capture image\");\r\n\r\n    const fd = new FormData();\r\n    fd.append(\"photo\", blob);\r\n    fd.append(\"consent\", \"yes\");\r\n\r\n    const res = await fetch(`${BACKEND}/api/upload-photo`, {\r\n      method: \"POST\",\r\n      body: fd\r\n    });\r\n\r\n    const json = await res.json();\r\n    setUploadInfo(json);\r\n\r\n    // Stop camera\r\n    if (stream) {\r\n      stream.getTracks().forEach((t) => t.stop());\r\n      setStream(null);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main style={{ padding: 20 }}>\r\n      <h1>Consent-Based Data Capture</h1>\r\n\r\n      {/* IP + Device */}\r\n      <section style={{ marginBlock: 20 }}>\r\n        <h2>1. Collect IP + Device (User Consent)</h2>\r\n        <button onClick={handleTrack}>I Consent â€” Log My Info</button>\r\n        <pre>{trackRes && JSON.stringify(trackRes, null, 2)}</pre>\r\n      </section>\r\n\r\n      {/* GPS */}\r\n      <section style={{ marginBlock: 20 }}>\r\n        <h2>2. GPS Collection (Browser Permission)</h2>\r\n        <button onClick={handleGPS}>Share GPS</button>\r\n        <pre>{gps}</pre>\r\n      </section>\r\n\r\n      {/* Photo */}\r\n      <section style={{ marginBlock: 20 }}>\r\n        <h2>3. Camera + Upload Photo</h2>\r\n        <button onClick={openCamera}>Open Camera</button>\r\n        <br /><br />\r\n        <video ref={videoRef} style={{ width: \"300px\" }} />\r\n        <br />\r\n        <button onClick={takePhoto}>Capture & Upload</button>\r\n\r\n        <pre>{uploadInfo && JSON.stringify(uploadInfo, null, 2)}</pre>\r\n      </section>\r\n\r\n      {/* QR Code */}\r\n      <section>\r\n        <h2>QR Code</h2>\r\n        <QRCodeCanvas value={typeof window !== \"undefined\" ? window.location.href : \"\"} size={180} />      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}